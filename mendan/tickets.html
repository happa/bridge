<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>面談予約システム - 面談チケット</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <!-- サイドバー -->
      <div class="col-md-2 d-none d-md-block sidebar py-3">
        <div class="text-center mb-4">
          <h5>面談予約システム</h5>
          <p class="text-muted small">生徒パネル</p>
        </div>
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="dashboard.html">
              <i class="fas fa-tachometer-alt me-2"></i>ダッシュボード
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="teachers.html">
              <i class="fas fa-chalkboard-teacher me-2"></i>先生を探す
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="appointments.html">
              <i class="fas fa-calendar-check me-2"></i>予約一覧
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="tickets.html">
              <i class="fas fa-ticket-alt me-2"></i>面談チケット
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="history.html">
              <i class="fas fa-history me-2"></i>過去の面談
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="settings.html">
              <i class="fas fa-cog me-2"></i>設定
            </a>
          </li>
          <li class="nav-item mt-5">
            <a class="nav-link text-danger" href="#">
              <i class="fas fa-sign-out-alt me-2"></i>ログアウト
            </a>
          </li>
        </ul>
      </div>
      <!-- メインコンテンツ -->
      <div class="col-md-10 ms-auto">
        <!-- ヘッダー -->
        <div class="row py-3 border-bottom">
          <div class="col">
            <h4 class="mb-0">面談チケット</h4>
          </div>
        </div>
        <!-- チケット残数とクーポン、購入履歴 -->
        <div class="p-3">
          <div class="row">
            <div class="col-md-4">
              <!-- チケット残数 -->
              <div class="card mb-4">
                <div class="card-header bg-light">
                  <h6 class="mb-0">チケット残数</h6>
                </div>
                <div class="card-body text-center">
                  <i class="fas fa-ticket-alt text-primary" style="font-size: 48px;"></i>
                  <h2 class="mt-3 mb-2">3枚</h2>
                  <p class="text-muted mb-0">使用可能なチケット</p>
                </div>
              </div>
              <!-- クーポン適用 -->
              <div class="card mb-4">
                <div class="card-header bg-light">
                  <h6 class="mb-0">クーポン適用</h6>
                </div>
                <div class="card-body">
                  <form id="coupon-form">
                    <div class="mb-3">
                      <label class="form-label">クーポンコード</label>
                      <div class="input-group">
                        <input type="text" class="form-control" id="coupon-code" placeholder="クーポンコードを入力">
                        <button class="btn btn-primary" type="button" onclick="applyCoupon()">適用</button>
                      </div>
                    </div>
                    <div id="coupon-success" class="alert alert-success d-none" role="alert">
                      <i class="fas fa-check-circle me-2"></i><span id="coupon-message"></span>
                    </div>
                    <div id="coupon-error" class="alert alert-danger d-none" role="alert">
                      <i class="fas fa-exclamation-circle me-2"></i>無効なクーポンコードです
                    </div>
                  </form>
                </div>
              </div>
              <!-- 購入履歴 -->
              <div class="card">
                <div class="card-header bg-light">
                  <h6 class="mb-0">購入履歴</h6>
                </div>
                <div class="card-body p-0">
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item purchase-history-item">
                      <div class="d-flex justify-content-between">
                        <span><i class="fas fa-ticket-alt me-2"></i>5枚セット</span>
                        <span class="badge bg-success">完了</span>
                      </div>
                      <div class="d-flex justify-content-between mt-1">
                        <small class="text-muted">2024/4/15</small>
                        <small>¥4,950（クーポン適用）</small>
                      </div>
                    </li>
                    <li class="list-group-item purchase-history-item">
                      <div class="d-flex justify-content-between">
                        <span><i class="fas fa-ticket-alt me-2"></i>1枚</span>
                        <span class="badge bg-success">完了</span>
                      </div>
                      <div class="d-flex justify-content-between mt-1">
                        <small class="text-muted">2024/4/1</small>
                        <small>¥1,500</small>
                      </div>
                    </li>
                    <li class="list-group-item purchase-history-item">
                      <div class="d-flex justify-content-between">
                        <span><i class="fas fa-ticket-alt me-2"></i>1枚（初回無料）</span>
                        <span class="badge bg-success">完了</span>
                      </div>
                      <div class="d-flex justify-content-between mt-1">
                        <small class="text-muted">2024/3/20</small>
                        <small>¥0</small>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <!-- チケット購入 -->
            <div class="col-md-8">
              <div class="card mb-4">
                <div class="card-header bg-light">
                  <h6 class="mb-0">チケットを購入</h6>
                </div>
                <div class="card-body">
                  <p>面談チケットを購入して、先生との面談予約に使用できます。</p>
                  <div class="row row-cols-1 row-cols-md-3 g-4 mb-4">
                    <div class="col">
                      <div class="card h-100 plan-card position-relative" onclick="selectPlan(this, '1ticket')">
                        <div class="card-body text-center">
                          <h5 class="card-title mb-3">1枚</h5>
                          <h3 class="mb-3">¥1,500</h3>
                          <p class="mb-3 text-muted">30分の面談<br>1回分</p>
                          <ul class="plan-features text-start small">
                            <li>有効期限: 3ヶ月</li>
                            <li>1回の面談に使用</li>
                          </ul>
                        </div>
                      </div>
                    </div>
                    <div class="col">
                      <div class="card h-100 plan-card position-relative" onclick="selectPlan(this, '3tickets')">
                        <span class="badge bg-primary position-absolute top-0 start-50 translate-middle">おすすめ</span>
                        <div class="card-body text-center">
                          <h5 class="card-title mb-3">3枚セット</h5>
                          <h3 class="mb-3">¥3,900</h3>
                          <p class="mb-3 text-muted">30分の面談<br>3回分</p>
                          <ul class="plan-features text-start small">
                            <li>有効期限: 6ヶ月</li>
                            <li>1枚あたり¥1,300</li>
                            <li>13%お得</li>
                          </ul>
                        </div>
                      </div>
                    </div>
                    <div class="col">
                      <div class="card h-100 plan-card position-relative" onclick="selectPlan(this, '5tickets')">
                        <span class="badge bg-success position-absolute top-0 start-50 translate-middle">お得</span>
                        <div class="card-body text-center">
                          <h5 class="card-title mb-3">5枚セット</h5>
                          <h3 class="mb-3">¥6,000</h3>
                          <p class="mb-3 text-muted">30分の面談<br>5回分</p>
                          <ul class="plan-features text-start small">
                            <li>有効期限: 12ヶ月</li>
                            <li>1枚あたり¥1,200</li>
                            <li>20%お得</li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div id="purchase-panel" class="d-none">
                    <hr>
                    <h6 class="mb-3">お支払い情報</h6>
                    <div class="row">
                      <div class="col-md-6">
                        <div id="plan-summary" class="mb-4">
                          <div class="d-flex justify-content-between mb-2">
                            <span>選択したプラン:</span>
                            <strong id="selected-plan-name">3枚セット</strong>
                          </div>
                          <div class="d-flex justify-content-between mb-2">
                            <span>通常価格:</span>
                            <span id="original-price">¥3,900</span>
                          </div>
                          <div id="discount-row" class="d-flex justify-content-between mb-2 text-success d-none">
                            <span>割引:</span>
                            <span id="discount-amount">-¥1,950</span>
                          </div>
                          <div class="d-flex justify-content-between mb-2">
                            <span>お支払い金額:</span>
                            <strong id="final-price">¥3,900</strong>
                          </div>
                          <div id="coupon-applied" class="mt-2 mb-3 text-success d-none">
                            <i class="fas fa-check-circle me-1"></i><span id="applied-coupon-message">クーポン「GW2024」が適用されました (50%OFF)</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="mt-3 d-flex justify-content-end">
                      <button class="btn btn-secondary me-2" onclick="cancelPurchase()">キャンセル</button>
                      <button class="btn btn-primary" onclick="openStripeModal()">Stripeで支払う</button>
                    </div>
                  </div>
                  
                  <div id="success-message" class="alert alert-success mt-3 d-none" role="alert">
                    <h5><i class="fas fa-check-circle me-2"></i>購入が完了しました！</h5>
                    <p class="mb-1">チケットがアカウントに追加されました。</p>
                    <p class="mb-0">すぐに面談の予約をしてみましょう。</p>
                    <div class="mt-3">
                      <a href="teachers.html" class="btn btn-primary">先生を探す</a>
                    </div>
                  </div>
                </div>
              </div>
              <!-- ストライプ決済モーダル -->
              <div class="stripe-modal" id="stripeModal">
                <div class="stripe-modal-content">
                  <span class="stripe-modal-close" onclick="closeStripeModal()">&times;</span>
                  <h5>クレジットカード決済</h5>
                  <p id="stripe-payment-description">3枚セット面談チケット: ¥3,900</p>
                  <form id="stripe-payment-form">
                    <div id="stripe-card-element"></div>
                    <div id="stripe-card-errors" role="alert"></div>
                    <button id="stripe-submit" class="btn btn-primary w-100">支払いを完了する</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div><!-- end p-3 -->
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
